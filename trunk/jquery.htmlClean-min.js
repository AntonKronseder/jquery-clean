(function(D){D.fn.htmlClean=function(Y){return this.each(function(){var Z=D(this);if(this.value){this.value=D.htmlClean(this.value,Y)}else{this.innerHTML=D.htmlClean(this.innerHTML,Y)}})};D.htmlClean=function(c,m){m=jQuery.extend(D.htmlClean.defaults,m);var f=/<(\/)?(\w+:)?([\w]+)([^>]*)>/gi;var i=/(\w+)=(".*?"|'.*?'|[^\s>]*?)/gi;var e;var g=new R();var h=[g];var Y=g;if(m.bodyOnly){if(e=/<body[^>]*>((\n|.)*)<\/body>/i.exec(c)){c=e[1]}}while(e=f.exec(c)){var l=new G(e[3],e[1],e[4]);var j=RegExp.leftContext.substring(d);if(j.length>0){var a=Y.children[Y.children.length-1];if(Y.children.length>0&&N(a=Y.children[Y.children.length-1])){Y.children[Y.children.length-1]=a.concat(j)}else{Y.children.push(j)}}var d=f.lastIndex;if(l.isClosing){if(H(h,[l.name])){h.pop();Y=h[h.length-1]}}else{var b=new R(l);if(!l.toIgnore){if(l.allowedAttributes!=null){var Z;while(Z=i.exec(l.rawAttributes)){if(l.allowedAttributes.length==0||D.inArray(Z[1],l.allowedAttributes)>-1){b.attributes.push(new A(Z[1],Z[2]))}}}var k=true;if(!Y.isRoot){if(Y.tag.isInline&&!l.isInline){k=false}else{if(Y.tag.disallowNest&&l.disallowNest&&!l.requiredParent){k=false}else{if(l.requiredParent){if(k=H(h,l.requiredParent)){Y=h[h.length-1]}}}}}if(k){Y.children.push(b);if(!l.isSelfClosing&&!l.isNonClosing){h.push(b);Y=b}}}}}return X(g,m).join("")};D.htmlClean.defaults={bodyOnly:true,removeAttrs:["class"]};function X(c,a){var Z=[];var d=c.attributes.length==0;for(var b=0;b<M.length;b++){if(M[b][0]==c.tag.name){if(M[b].length==1||M[b][1].test(c.tag.rawAttributes)){c.tag.name=U[b]}}}if(!c.isRoot){Z.push("<");Z.push(c.tag.name);D.each(c.attributes,function(){if(D.inArray(this.name,a.removeAttrs)==-1&&this.value!=null&&this.value.length>0){Z.push(" ");Z.push(this.name);Z.push("=");Z.push(this.value)}})}if(c.tag.isSelfClosing){Z.push(" />");d=false}else{if(c.tag.isNonClosing){d=false}else{if(!c.isRoot){Z.push(">")}var Y=[];for(var b=0;b<c.children.length;b++){var f=c.children[b];var e=D.htmlClean.trim(C(f.toString()));if(Q(f)){if(b>0&&e.length>0&&(W(f)||F(c.children[b-1]))){Y.push(" ")}}if(N(f)){if(e.length>0){Y.push(e)}}else{if(b!=c.children.length-1||f.tag.name!="br"){Y=Y.concat(X(f,a))}}}if(Y.length>0){Z=Z.concat(Y);d=false}if(!c.isRoot){Z.push("</");Z.push(c.tag.name);Z.push(">")}}}if(!c.tag.allowEmpty&&d){return[]}return Z}function H(Y,a,Z){Z=Z||1;if(D.inArray(Y[Y.length-Z].tag.name,a)>-1){return true}else{if(Y.length-(Z+1)>0&&H(Y,a,Z+1)){Y.pop();return true}}return false}function R(Y){if(Y){this.tag=Y;this.isRoot=false}else{this.tag=new G("root");this.isRoot=true}this.attributes=[];this.children=[];this.toString=function(){return this.children.join("")};return this}function A(Y,Z){this.name=Y;this.value=Z;return this}function G(Y,a,Z){this.name=Y.toLowerCase();this.isSelfClosing=D.inArray(this.name,J)>-1;this.isNonClosing=D.inArray(this.name,S)>-1;this.isClosing=(a!=undefined&&a.length>0);this.isInline=D.inArray(this.name,T)>-1;this.disallowNest=D.inArray(this.name,P)>-1;this.requiredParent=E[D.inArray(this.name,E)+1];this.allowEmpty=D.inArray(this.name,B)>-1;this.toIgnore=D.inArray(this.name,I)>-1;this.rawAttributes=Z;this.allowedAttributes=K[D.inArray(this.name,K)+1];return this}function W(Y){while(O(Y)&&Y.children.length>0){Y=Y.children[0]}return N(Y)&&Y.length>0&&D.htmlClean.isWhitespace(Y.charAt(0))}function F(Y){while(O(Y)&&Y.children.length>0){Y=Y.children[Y.children.length-1]}return N(Y)&&Y.length>0&&D.htmlClean.isWhitespace(Y.charAt(Y.length-1))}function N(Y){return Y.constructor==String}function Q(Y){return N(Y)||Y.tag.isInline}function O(Y){return Y.constructor==R}function C(Y){return Y.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}D.htmlClean.trim=function(Y){return D.htmlClean.trimStart(D.htmlClean.trimEnd(Y))};D.htmlClean.trimStart=function(Y){return Y.substring(D.htmlClean.trimStartIndex(Y))};D.htmlClean.trimStartIndex=function(Y){for(var Z=0;Z<Y.length-1&&D.htmlClean.isWhitespace(Y.charAt(Z));Z++){}return Z};D.htmlClean.trimEnd=function(Y){return Y.substring(0,D.htmlClean.trimEndIndex(Y))};D.htmlClean.trimEndIndex=function(Z){for(var Y=Z.length-1;Y>=0&&D.htmlClean.isWhitespace(Z.charAt(Y));Y--){}return Y+1};D.htmlClean.isWhitespace=function(Y){return D.inArray(Y,V)!=-1};var I=["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"];var M=[["b"],["big"],["span",/weight:\s*bold/i],["i"],["span",/style:\s*italic/i],["span",/-align:\s*super/i],["span",/-align:\s*sub/i]];var U=["strong","strong","strong","em","em","sup","sub"];var T=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","samp","select","small","span","strong","sub","sup","tt","var"];var P=["h1","h2","h3","h4","h5","h6","p","th","td"];var B=["th","td"];var E=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"]];var L=["script","style","pre","code"];var J=["br","hr","img","link","meta"];var S=["!doctype","?xml"];var K=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"]];var V=[" "," ","\t","\n","\r","\f"]})(jQuery);